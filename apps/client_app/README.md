# Eazy Client App

Flutter client scaffold with Riverpod, GoRouter, Dio, dotenv, and Firebase Auth.

## Getting Started

1. Copy env:
```bash
cp .env.sample .env
# set required keys
# API_BASE_URL=...
# GOOGLE_MAPS_API_KEY=...
# STRIPE_PUBLISHABLE_KEY=...
```
2. Install dependencies:
```bash
flutter pub get
```
3. Firebase setup:
- Install FlutterFire CLI and configure:
```bash
dart pub global activate flutterfire_cli
flutterfire configure --project=<your-firebase-project>
```
This generates `lib/core/firebase/firebase_options.dart` (replace the placeholder).

- Platform notes:
  - Android: ensure `applicationId` matches your Firebase Android app.
  - iOS/macOS: add `GoogleService-Info.plist` per Firebase docs.
  - Web: ensure `index.html` has no conflicting Firebase scripts; FlutterFire handles initialization.

4. Run analysis:
```bash
flutter analyze
```
5. Run:
```bash
flutter run -d ios # or -d macos / android / chrome
```

## Routes
- `/splash` → `/login` or `/home`
- `/login`, `/verify-otp`
- `/home`
- `/catalog`, `/search`, `/cart`, `/profile`
- `/addresses`, `/address-form`

## CI/CD (iOS TestFlight)
- Workflow: `.github/workflows/ios-beta.yml`
- Tag push `vX.Y.Z` triggers build with Flutter 3.24 and Fastlane upload
- Secrets required:
  - `APP_STORE_CONNECT_API_KEY_ID`
  - `APP_STORE_CONNECT_API_ISSUER_ID`
  - `APP_STORE_CONNECT_API_KEY_CONTENT`

## Structure
- `lib/app.dart`: App root with MaterialApp.router
- `lib/core/router/router.dart`: GoRouter configuration
- `lib/core/theme/theme.dart`: Theme setup
- `lib/core/network/dio_client.dart`: Preconfigured Dio client
- `lib/core/firebase/firebase_options.dart`: Generated by FlutterFire
- `lib/features/splash/presentation/splash_screen.dart`: Splash screen
- `lib/features/auth/presentation/login_screen.dart`: Login screen
- `lib/features/auth/presentation/verify_otp_screen.dart`: Verify OTP screen
- `lib/features/home/presentation/home_screen.dart`: Home with tabs
- `lib/features/address/*`: C003 Addresses feature (see below)
- `lib/features/auth/data/*`: Auth API/storage/Firebase repo
- `lib/features/auth/domain/*`: Auth state/tokens

## C003 Addresses
- Feature location: `lib/features/address/`
  - `models/address.dart` — data model and Places results types
  - `data/address_repository.dart` — repository contract
  - `data/firebase_address_repository.dart` — Firestore impl: `users/{uid}/addresses/{id}`
  - `data/places_service.dart` — Google Places Autocomplete + Place Details (HTTP)
  - `state/address_controller.dart` — Riverpod AsyncNotifier with CRUD and primary
  - `ui/addresses_page.dart`, `ui/address_form_page.dart`, widgets

- Routes:
  - `/addresses` — list
  - `/address-form` — create/edit (pass id via `extra` to edit)

- Google Places API key:
  - Provide at runtime via `GOOGLE_MAPS_API_KEY` using `--dart-define=GOOGLE_MAPS_API_KEY=YOUR_KEY`
  - Add `.env.sample` with placeholder and copy to `.env` for local usage reference
  - Without a key, autocomplete is disabled and helper shows “Введите адрес полностью”

- Validation:
  - Required: `fullText` OR (`city` + `street`)
  - If `placeId` present, `lat/lng` are required (resolved via Place Details)
  - `label` ≤ 40 chars; `deliveryNote` ≤ 200 chars
